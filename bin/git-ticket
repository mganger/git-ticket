#!/bin/bash

case $1 in 
	start)
		ti checkout $1
		tmp=$(mktemp)
		ti show $1 > $tmp

		title=$(grep Title $tmp | cut -d: -f 2 | xargs | sed -r 's/\s+/-/g' | tr '[:upper:]' '[:lower:]')
		id=$(grep TicId $tmp | cut -d: -f 2 | xargs | cut -c 1-6)

		echo $title > .git/current_title
		echo $id    > .git/current_ticket

		git flow feature start $id-$title
		;;
	list)
		case $2 in
			--number|-n)
				ti list | tail -n +4 | head -n -1 | cat -n
				;;
			*)
				ti $@
				;;
		esac
		;;
	finish)
		if [ -e .git/current_title -a -e .git/current_ticket ]
		then
			git flow feature finish $(cat current_title)-$(cat current_ticket)
			rm .git/current_title
			rm .git/current_ticket
		else
			echo No ticket checked out
		fi	
		;;
	current)
		if [ -e .git/current_title -a -e .git/current_ticket ]
		then
			echo $(cat current_title)-$(cat current_ticket)
		else
			echo No ticket currently in development
		fi	
		;;
	*)
		ti $@
		;;
esac
